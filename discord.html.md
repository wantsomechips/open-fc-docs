# Discord Implementation


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Set up the Discord Bot Configuration

Step 1: Create a Bot via [Discord Developer
Portal](https://discord.com/developers/applications)

- Create a Bot via Discord Developer Portal
- Go to the Discord Developer Portal.
- Click “New Application”, give it a name.
- In the left menu, go to “Bot” and click “Add Bot”.
- Under “Privileged Gateway Intents”, enable at least: MESSAGE CONTENT
  INTENT, PRESENCE and GUILD MEMBERS if your bot needs them(Optional).

Step 2: Get the Bot Token

- In the “Bot” section, click “Reset Token” and copy it.
- Store the token in `.env` as `DISCORD_TOKEN=<Your-Discord-Token>`.

Step 3: Invite the Bot to Your Server

- Go back to the Developer Portal, click “OAuth2”.
- In “OAuth2 URL Generator” scopes, select: “bot”,
  “applications.commands” and
  “applications.commands.permissions.update”.
- In “Bot Permissions” select: “Send Messages”, “Read Messages” etc.
- Copy the “Generated URL”, open it in a browser, and invite the bot to
  your server.

## Run the bot

Run `bot.run(discord_token)` in your Python code to start the bot. Or
you can set the `manual_test = True` and run the code in the cell named
Test Section below.

## Use the bot in a server

Type in !command or Slash command in Discord Server to use the bot.

Example inputs:

- `!cal three + 2`
- `/cal query: 3 + 6`

## Import Required Modules

This notebook uses the
[`async_chat_bot`](https://wantsomechips.github.io/openai-fc/openai.html#async_chat_bot)
and `logger` we implemented. We also need `discord` to implements
Discord Bot.

## Load Environment Variable

Load environment variable `DISCORD_TOKEN`.

## Implements Discord Bot

IMPORTANT: You must have access to the `message_content` intent for the
commands extension to function. This must be set both in the developer
portal and within the code.

Failure to do this will result in your bot not responding to any of your
commands.

### Code Note

`@bot.command()` can use `*arg` to pass an undetermined number of
parameters. Since the `args` variable is a tuple, you can do anything
you would usually do with one. But it doesn’t support slash command.

Therefore, we need to use `@bot.hybrid_command()`. And use Keyword-Only
Arguments instead because `*arg` isn’t supported.

- `@bot.hybrid_command`: Registers a command that works for both
  `/slash` and `!prefix` style commands.

Specifically, to tackle the problems we met, you need to
`await bot.tree.sync()` in `on_ready()`to build the Slash command,
`await bot.process_commands(msg)` in `on_message()` to process your
command and `await ctx.defer()` to prevent Slash command from failing
for not in time response.

------------------------------------------------------------------------

<a
href="https://github.com/wantsomechips/openai-fc/blob/main/openai_fc/discord_bot.py#L27"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_discord_bot

>  get_discord_bot ()

*Initiliaze and return a Discord bo.*
